<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consulta de Documenta√ß√£o</title>
  <!-- Depend√™ncias globais necess√°rias para header/footer -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', sans-serif; background-color: #f9f9f9; }
    /* Estilo da consulta */
    .consulta-container { max-width: 700px; margin: 60px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    .consulta-container h1 { text-align: center; margin-bottom: 30px; font-weight: 600; font-size: 24px; color: #003366; }
    .consulta-container label { font-weight: 500; display: block; margin-bottom: 8px; }
    .consulta-container input[type="text"] { width: 100%; padding: 10px; font-size: 16px; text-align: center; margin-bottom: 20px; border-radius: 6px; border: 1px solid #ccc; }
    .consulta-container button { width: 100%; padding: 12px; font-size: 16px; font-weight: bold; color: white; background-color: #4a90e2; border: none; border-radius: 6px; cursor: pointer; }
    .consulta-container button:hover { background-color: #357ab8; }
    .card { border: none; border-radius: 10px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); background-color: #ffffff; margin-top: 30px; padding: 20px; }
    .data-section { margin-bottom: 30px; }
    .data-section h3 { font-size: 18px; color: #003366; border-bottom: 2px solid #003366; padding-bottom: 5px; margin-bottom: 15px; }
    .data-section ul { list-style: none; padding: 0; }
    .data-section li { margin-bottom: 8px; }
    /* --- Estilo para abas e status --- */
    .tabs { display: flex; justify-content: center; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
    .tab-button { padding: 10px 20px; font-weight: bold; background-color: #e0e0e0; color: #003366; border: none; border-radius: 20px; cursor: pointer; transition: all 0.2s ease; }
    .tab-button.active { background-color: #003366; color: #fff; }
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }
    .tab-content ul { list-style: none; padding-left: 0; margin-top: 10px; }
    .tab-content li { margin-bottom: 8px; font-size: 16px; line-height: 1.5; }
    li[data-status="COMPLETA"]::before { content: "‚úÖ "; color: green; }
    li[data-status="INCOMPLETA"]::before { content: "‚ö†Ô∏è "; color: orange; }
    li[data-status="PROTOCOLADA"]::before { content: "üìë "; color: teal; }
    li[data-status="EM FILA"]::before { content: "‚è≥ "; color: #007bff; }
    li[data-status*="LISTA"]::before { content: "üü¢ "; color: green; }
    li[data-status*="N√ÉO"]::before { content: "‚ùå "; color: red; }

    /* Avisos */
    .warning {
      background-color: #fff8e1;
      border-left: 6px solid #ffb300;
      color: #333;
      padding: 16px 20px;
      margin: 20px 0;
      font-size: 15px;
      line-height: 1.6;
      border-radius: 8px;
    }
/* Estilos m√≠nimos para o header carregado (igual ao diretoria.html) */
    header { background-color: #003366; padding: 20px; color: white; }
    nav { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .logo img { height: 50px; }
    nav ul { display: flex; list-style: none; gap: 20px; flex-wrap: wrap; }
    nav ul li { position: relative; }
    nav ul li a {
      color: white; text-decoration: none; font-weight: 600;
      padding: 8px 12px; display: block; transition: background-color 0.3s ease;
    }
    nav ul li a:hover { background-color: #005599; border-radius: 4px; }
    nav ul li ul {
      display: none; position: absolute; background-color: #004080;
      top: 100%; left: 0; min-width: 220px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2); z-index: 10;
    }
    nav ul li:hover ul { display: block; animation: fadeIn 0.3s ease-in-out; }
    nav ul li ul li a { padding: 10px; font-weight: 400; }
    @keyframes fadeIn { from {opacity: 0; transform: translateY(-8px);} to {opacity: 1; transform: translateY(0);} }
    @media (max-width: 768px) {
      nav ul { flex-direction: column; align-items: flex-start; }
    }

      .subtitle{margin-top:10px; margin-bottom:18px; text-align:center; font-size:18px; font-weight:700; color:#003366; opacity:0.9;}

  
    .info-box{
      margin: 0 auto 22px auto;
      padding: 18px 18px 14px;
      background: #ffffff;
      border: 1px solid rgba(0,0,0,0.08);
      border-radius: 14px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      text-align: left;
    }
    .info-box h2{
      margin: 0 0 10px;
      font-size: 18px;
      color: #003366;
      letter-spacing: .3px;
    }
    .info-box h3{
      margin: 14px 0 8px;
      font-size: 16px;
      color: #003366;
    }
    .info-box p{
      margin: 0 0 12px;
      line-height: 1.45;
      color: #1b2b3a;
    }
    .info-grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin: 8px 0 10px;
    }
    .info-item{
      padding: 10px 12px;
      border-radius: 12px;
      background: #f4f6f9;
      border: 1px solid rgba(0,0,0,0.06);
      color: #1b2b3a;
    }
    .info-label{
      font-weight: 700;
      color: #003366;
    }
    .info-list{
      margin: 8px 0 0;
      padding-left: 18px;
      color: #1b2b3a;
      line-height: 1.45;
    }
    .info-list li{ margin-bottom: 8px; }
    @media (min-width: 900px){
      .info-grid{ grid-template-columns: 1fr 1fr; }
      .info-grid .info-item:nth-child(3){ grid-column: 1 / -1; }
    }

  
    .hint{
      margin: 10px 0 0;
      font-size: 13px;
      opacity: .85;
      text-align:center;
    }
  </style>
</head>
<body>
  <!-- Header externo -->
  <div id="header-container"></div>

  <!-- CONTE√öDO PRINCIPAL -->
  <section style="padding: 60px 20px; background-color: #f4f6f9;">
    <div class="consulta-container">
      <h1>CONSULTA - LISTA INICIAL (NOME)</h1>
      <div class="subtitle">Aux√≠lio Moradia - Coletivo</div>
      
      <div class="info-box">
        <h2>AUX√çLIO MORADIA COLETIVO</h2>
        <p>A Associa√ß√£o orienta os interessados a consultarem a <strong>listagem inicial</strong> do Aux√≠lio Moradia Coletivo (2008) para verificar se o seu nome, ou o nome da pensionista/inativo, consta entre os benefici√°rios.</p>

        <div class="info-grid">
          <div class="info-item"><span class="info-label">Processo:</span> iniciado em 2014</div>
          <div class="info-item"><span class="info-label">A√ß√£o Ordin√°ria n¬∫:</span> 20.675-13.2014.4.01.3400</div>
          <div class="info-item"><span class="info-label">Prazo final para reivindica√ß√£o de direitos (prescri√ß√£o):</span> mar√ßo de 2026</div>
        </div>

        <h3>Regras para recebimento dos valores</h3>
        <ul class="info-list">
          <li><strong>Benefici√°rios vivos</strong> que constam na listagem: t√™m direito ao recebimento dos valores do Aux√≠lio Moradia referentes ao per√≠odo de <strong>setembro de 2014 a 2025</strong>.</li>
          <li><strong>Benefici√°rios falecidos</strong> que constam na listagem: os herdeiros t√™m direito ao recebimento dos valores do Aux√≠lio Moradia referentes ao per√≠odo de <strong>setembro de 2014 at√© a data do √≥bito</strong>, observadas as regras legais aplic√°veis.</li>
          <li><strong>√ìbito ocorrido antes de 2014:</strong> n√£o h√° direito ao recebimento de valores.</li>
        </ul>
      </div>

<label for="nomeInput">Digite seu nome completo:</label>
      <input id="nomeInput" placeholder="Digite o nome completo (sem abrevia√ß√µes)" type="text"/>
      <button id="consultNomeBtn">CONSULTAR</button>
      <p class="hint">Dica: informe o <strong>nome completo</strong>. A busca por nome exige correspond√™ncia exata (sem acentos e em mai√∫sculas, como na listagem).</p>
      <div style="text-align:center; margin-top:12px;">
        <a href="lista_aux.html" style="font-weight:700; color:#003366; text-decoration:underline;">Voltar para pesquisa por CPF</a>
      </div>
      <div id="resultContainer"></div>
    </div>
  </section>

  <section style="padding: 50px 20px; background-color: #003366; color: white; text-align: center;">
    <h2>Associe-se √† APIPMCBDF</h2>
    <p style="max-width: 700px; margin: 20px auto;">Junte-se a centenas de associados que t√™m seus direitos defendidos com firmeza e comprometimento. Seja representado, tenha acesso a benef√≠cios exclusivos e fa√ßa parte da nossa hist√≥ria!</p>
    <a href="seja-socio.html" style="display: inline-block; margin-top: 20px; padding: 12px 24px; background-color: #f5b200; color: black; text-decoration: none; border-radius: 5px; font-weight: bold;">Quero me associar</a>
  </section>

  <section style="padding: 40px 20px; text-align: center; background-color: #fff;">
    <h2>Quem Somos</h2>
    <p style="max-width: 800px; margin: auto;">A APIPMCBDF representa e apoia os pensionistas e inativos da Pol√≠cia Militar e Corpo de Bombeiros do Antigo e Atual Distrito Federal. Lutamos por direitos, assist√™ncia e valoriza√ß√£o dos nossos associados.</p>
    <a href="sobre.html" style="display: inline-block; margin-top: 20px; padding: 10px 20px; background-color: #003366; color: white; text-decoration: none; border-radius: 5px;">Saiba mais</a>
  </section>

  <!-- Footer externo -->
  <div id="footer-container"></div>

  <!-- Includes de header e footer -->
  <script>
    (function loadHeader(){
      const el = document.getElementById('header-container');
      if (!el) return;
      fetch('header.html', { cache: 'no-store' })
        .then(r => r.text()).then(html => el.innerHTML = html)
        .catch(() => el.innerHTML = '<!-- falha ao carregar header -->');
    })();

    (function loadFooter(){
      const el = document.getElementById('footer-container');
      if (!el) return;
      fetch('footer.html', { cache: 'no-store' })
        .then(r => r.text()).then(html => el.innerHTML = html)
        .catch(() => el.innerHTML = '<!-- falha ao carregar footer -->');
    })();
    function toggleMenu() {
      var menu = document.getElementById("menu");
      if (menu) menu.classList.toggle("active");
    }
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDoXdgj_fRuYTluJby6QOIiEYBu268lZmQ",
      authDomain: "documentos-apipmcbdf.firebaseapp.com",
      projectId: "documentos-apipmcbdf",
      storageBucket: "documentos-apipmcbdf.appspot.com",
      messagingSenderId: "422508459389",
      appId: "1:422508459389:web:bebd6b53839f77a3cd4814"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    function formatarCPF(cpf) {
      return cpf.replace(/\D/g, '').padStart(11, '0');
    }

    function normalizarNome(nome) {
      return (nome || '')
        .toString()
        .trim()
        .normalize('NFD')
        .replace(/\p{Diacritic}/gu, '')
        .replace(/\s+/g, ' ')
        .toUpperCase();
    }


    function criarLista(campos, data) {
      const ul = document.createElement('ul');
      for (let campo of campos) {
        let valor = data[campo];
        if (!valor || !valor.toString().trim()) continue;

        let status = valor.toString().toUpperCase();

        // Renomeia "Status VPE"/"Status AUX" para "Pend√™ncias" se documenta√ß√£o estiver incompleta
        if ((campo === 'Status VPE' && (data['Documenta√ß√£o VPE'] || '').toUpperCase() === 'INCOMPLETA') ||
            (campo === 'Status AUX' && (data['Documenta√ß√£o AUX'] || '').toUpperCase() === 'INCOMPLETA')) {
          campo = 'Pend√™ncias';
        }

        // Renomeia "Recebe VPE" para "Lista de implanta√ß√£o" se estiver em uma das listas
        if (campo === 'Recebe VPE' && ['SEGUNDA LISTA DE IMPLANTA√á√ÉO VPE','TERCEIRA LISTA DE IMPLANTA√á√ÉO VPE','QUARTA LISTA DE IMPLANTA√á√ÉO VPE'].includes(status)) {
          campo = 'Lista de implanta√ß√£o';
        }

        const li = document.createElement('li');
        li.setAttribute('data-status', status);

        // Formata√ß√£o amig√°vel com quebra de linhas para pend√™ncias
        if (campo === 'Pend√™ncias') {
          const pendencias = valor.split(';').map(p => `<li>üìå ${p.trim()}</li>`).join('');
          li.innerHTML = `<strong>Pend√™ncias:</strong><ul style='margin-top:8px; padding-left: 18px;'>${pendencias}</ul>`;
        } else {
          li.textContent = `${campo}: ${valor}`;
        }
        ul.appendChild(li);
      }
      return ul.childElementCount ? ul : null;
    }

    function mostrarDados(data) {
      const container = document.getElementById('resultContainer');
      container.innerHTML = '';

      // Regras: se existir e exists === true, mostrar nome e mensagem + bot√£o
      const existsFlag = data && (data.exists === true || data['exists'] === true);

      if (!data || Object.keys(data).length === 0 || !existsFlag) {
        container.innerHTML = `
          <div class="card">
            <p style="padding:20px; text-align:center; font-weight:bold;">‚ùå Seu CPF n√£o consta na listagem inicial.</p>
            <p style="padding:0 20px 20px; text-align:center; opacity:.85;">
              Se voc√™ acredita que isso √© um erro, entre em contato com a Associa√ß√£o.
            </p>
          </div>`;
        return;
      }

      const nome = data.nome ?? data['nome'] ?? data.NOME ?? data['NOME'] ?? '';

      const card = document.createElement('div');
      card.className = 'card';

      const title = document.createElement('div');
      title.style.fontSize = '18px';
      title.style.fontWeight = '600';
      title.style.color = '#003366';
      title.style.marginBottom = '12px';
      title.textContent = 'Resultado da Consulta';
      card.appendChild(title);

      const ul = document.createElement('ul');
      ul.style.listStyle = 'none';
      ul.style.paddingLeft = '0';

      const liNome = document.createElement('li');
      liNome.style.marginBottom = '10px';
      liNome.textContent = `NOME: ${nome ? nome.toString().trim() : ''}`;
      ul.appendChild(liNome);

      card.appendChild(ul);

      // Mensagem principal
      const msg = document.createElement('div');
      msg.className = 'warning';
      msg.innerHTML = `‚úÖ Seu nome aparece na <strong>listagem inicial</strong>. Antes de prosseguir, verifique a documenta√ß√£o e aguarde a an√°lise de elegibilidade (podem existir impedimentos jur√≠dicos).`;
      card.appendChild(msg);

      const avisoImportante = document.createElement('div');
      avisoImportante.className = 'warning';
      avisoImportante.innerHTML = `
        <strong>Importante</strong><br/>
        As pessoas que ingressaram com a√ß√£o individual e tiveram decis√£o desfavor√°vel n√£o podem participar da execu√ß√£o promovida pela Associa√ß√£o. Isso ocorre porque, quando j√° existe decis√£o judicial definitiva ou outro processo sobre o mesmo assunto, n√£o √© permitido apresentar novo pedido, mesmo com o envio de documentos ou ades√£o a acordo.
      `;
      card.appendChild(avisoImportante);

      const avisoDevolucao = document.createElement('div');
      avisoDevolucao.className = 'warning';
      avisoDevolucao.innerHTML = `
        <strong>Devolu√ß√£o de documentos</strong><br/>
        Os associados que j√° entregaram a documenta√ß√£o, mas que n√£o poder√£o participar da execu√ß√£o, poder√£o entrar em contato com a Associa√ß√£o para solicitar a devolu√ß√£o dos documentos apresentados.
      `;
      card.appendChild(avisoDevolucao);

      // Bot√£o/link para conferir documenta√ß√£o
      const btnWrap = document.createElement('div');
      btnWrap.style.marginTop = '16px';
      btnWrap.style.display = 'flex';
      btnWrap.style.justifyContent = 'center';

      const a = document.createElement('a');
      a.href = 'consulta_doc_aux.html';
      a.textContent = 'CONFIRA SUA DOCUMENTA√á√ÉO';
      a.style.display = 'inline-block';
      a.style.padding = '14px 22px';
      a.style.borderRadius = '10px';
      a.style.background = '#2f7bd9';
      a.style.color = '#fff';
      a.style.fontWeight = '700';
      a.style.textDecoration = 'none';
      a.style.letterSpacing = '0.5px';

      a.onmouseenter = () => a.style.filter = 'brightness(0.95)';
      a.onmouseleave = () => a.style.filter = 'none';

      btnWrap.appendChild(a);
      card.appendChild(btnWrap);

      container.appendChild(card);
    }

    window.addEventListener('DOMContentLoaded', () => {
      document.// Consulta por NOME (campo 'nome' no Firestore, em MAI√öSCULO e sem acentos)
      getElementById('consultNomeBtn').onclick = async () => {
        const rawNome = document.getElementById('nomeInput').value;
        const nome = normalizarNome(rawNome);
        if (!nome || nome.length < 5) { alert('Digite o nome completo.'); return; }

        try {
          const colRef = collection(db, 'ListaCPFs');
          const q = query(colRef, where('nome', '==', nome), limit(10));
          const snaps = await getDocs(q);

          if (snaps.empty) {
            mostrarDados({});
            return;
          }

          // Se houver mais de 1, mostra lista para selecionar
          if (snaps.size > 1) {
            const container = document.getElementById('resultContainer');
            container.innerHTML = '';
            const card = document.createElement('div');
            card.className = 'card';

            const title = document.createElement('div');
            title.style.fontSize = '18px';
            title.style.fontWeight = '600';
            title.style.color = '#003366';
            title.style.marginBottom = '12px';
            title.textContent = 'Encontramos mais de um registro com este nome';
            card.appendChild(title);

            const p = document.createElement('p');
            p.style.margin = '0 0 12px';
            p.style.opacity = '.9';
            p.textContent = 'Selecione o seu registro pelo final do CPF:';
            card.appendChild(p);

            const ul = document.createElement('ul');
            ul.style.listStyle = 'none';
            ul.style.paddingLeft = '0';

            snaps.forEach(docSnap => {
              const data = docSnap.data() || {};
              const cpfId = docSnap.id || '';
              const cpfMasked = cpfId ? ('***.***.***-' + cpfId.slice(-3)) : 'CPF n√£o dispon√≠vel';

              const li = document.createElement('li');
              li.style.marginBottom = '10px';

              const btn = document.createElement('button');
              btn.type = 'button';
              btn.textContent = cpfMasked;
              btn.style.padding = '10px 12px';
              btn.style.borderRadius = '10px';
              btn.style.border = '1px solid rgba(0,0,0,0.12)';
              btn.style.background = '#fff';
              btn.style.cursor = 'pointer';
              btn.style.fontWeight = '700';
              btn.onclick = () => mostrarDados(data);

              li.appendChild(btn);
              ul.appendChild(li);
            });

            card.appendChild(ul);
            container.appendChild(card);
            return;
          }

          const only = snaps.docs[0].data() || {};
          mostrarDados(only);

        } catch (err) {
          console.error(err);
          document.getElementById('resultContainer').innerHTML = `
            <div class="card">
              <p style="padding:18px; text-align:center; font-weight:700;">‚ùå Erro ao consultar.</p>
              <p style="padding:0 18px 18px; text-align:center; opacity:.85;">${(err && err.message) ? err.message : String(err)}</p>
            </div>`;
        }
      };
    });
  </script>
  <noscript>
    <iframe src="header.html" title="Cabe√ßalho" style="width:100%; border:0; height:160px;"></iframe>
    <iframe src="footer.html" title="Rodap√©" style="width:100%; border:0; height:320px;"></iframe>
  </noscript>

</body>
</html>
