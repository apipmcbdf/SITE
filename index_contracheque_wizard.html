<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Simulador de Reajustes do Contracheque 2025/2026</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" />
  <link rel="stylesheet" href="contracheque_corrigido_v3b.css" />
  <style>
    body { padding-top: 70px; }
    .step { display: none; }
    .step.active { display: block; }
    .muted { color:#6c757d; font-size:12px; }
    .chip { display:inline-block; padding:.25rem .5rem; border-radius: 999px; background:#eef2f7; margin:.125rem; font-size:.875rem; }
    .wizard-footer { display:flex; justify-content:space-between; flex-wrap: wrap; gap:.5rem; }
    .table thead th { white-space: normal; }
    .is-invalid + .invalid-feedback { display:block; }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark fixed-top topo-ini">
    <span class="navbar-brand">Simulador de Reajustes do Contracheque 2025/2026</span>
    <button class="btn btn-outline-light btn-sm ml-auto" id="resetTop">Reset</button>
  </nav>

  <div class="container">
    <div class="row">
      <div class="col-12 col-lg-8 mx-auto">
        
        <!-- Step 0: Introdução -->
        <section id="step0" class="step active">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3">Antes de começar</h5>
              <p class="mb-3">
                Tenha o seu <strong>contracheque atual</strong> em mãos para selecionar corretamente as opções nas próximas etapas.
                <br><small class="text-muted">Este é um <strong>simulador</strong>; a <em>assertividade</em> depende da seleção correta das opções.
                O simulador considera que a <strong>pensão é recebida integralmente por um único beneficiário</strong> (sem divisão de cotas).
                Dica: se tiver dúvida, use <strong>30</strong> em “Tempo de Serviço”.</small>
              </p>
              <div class="wizard-footer">
                <button class="btn btn-primary" id="startBtn">Começar</button>
                <button class="btn btn-link" id="reset0">Reset</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 1: Posto/Graduação -->
        <section id="step1" class="step">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-3">Selecione o Posto/Graduação</h5>
              <div class="form-group">
                <label for="postoSel">Posto/Graduação</label>
                <select class="form-control" id="postoSel">
                  <option value="" selected>— selecione —</option>
                </select>
                <small class="muted d-block">Use a mesma nomenclatura do seu contracheque.</small>
              </div>
              <div class="wizard-footer">
                <button class="btn btn-secondary" data-back>Voltar</button>
                <div>
                  <button class="btn btn-link" id="reset1">Reset</button>
                  <button class="btn btn-primary" id="toStep2" disabled>Continuar</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 2: Auxílio-moradia e VPE -->
        <section id="step2" class="step">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-2">Benefícios</h5>
              <p class="muted mb-3">Selecione conforme aparece no seu contracheque.</p>
              <div class="form-group">
                <label class="d-block">Auxílio-moradia</label>
                <div class="custom-control custom-radio">
                  <input type="radio" id="auxNao" name="aux" value="NAO" class="custom-control-input" checked>
                  <label class="custom-control-label" for="auxNao">Não</label>
                </div>
                <div class="custom-control custom-radio">
                  <input type="radio" id="auxCom" name="aux" value="COM_DEP" class="custom-control-input">
                  <label class="custom-control-label" for="auxCom">Com dependente</label>
                </div>
                <div class="custom-control custom-radio">
                  <input type="radio" id="auxSem" name="aux" value="SEM_DEP" class="custom-control-input">
                  <label class="custom-control-label" for="auxSem">Sem dependente</label>
                </div>
              </div>
              <div class="form-group">
                <label class="d-block">VPE</label>
                <div class="custom-control custom-radio">
                  <input type="radio" id="vpeSim" name="vpe" value="SIM" class="custom-control-input">
                  <label class="custom-control-label" for="vpeSim">Sim</label>
                </div>
                <div class="custom-control custom-radio">
                  <input type="radio" id="vpeNao" name="vpe" value="NAO" class="custom-control-input" checked>
                  <label class="custom-control-label" for="vpeNao">Não</label>
                </div>
              </div>
              <div class="wizard-footer">
                <button class="btn btn-secondary" data-back>Voltar</button>
                <div>
                  <button class="btn btn-link" id="reset2">Reset</button>
                  <button class="btn btn-primary" id="toStep3">Continuar</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 3: Tempo de Serviço -->
        <section id="step3" class="step">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-2">Tempo de Serviço</h5>
              <p class="muted mb-3">Informe o seu tempo de serviço (em anos). Se não souber, calcule pelo contracheque recente: divida o valor de <strong>“ADIC.TEMP.SERVICO-MILITAR INAT”</strong> pelo valor de <strong>“GRATIFICACAO DE REPRES.MILITAR”</strong>. O resultado corresponde, aproximadamente, aos seus anos de serviço. <small>Ex.: 1.200,00 ÷ 40,00 = 30 anos.</small></p>
              <div class="form-group">
                <label for="tempoInput">Tempo de serviço (1 a 40)</label>
                <input type="number" id="tempoInput" class="form-control" min="1" max="40" step="1" value="30" inputmode="numeric" pattern="[0-9]*" />
                <div class="invalid-feedback">Informe um número inteiro entre 1 e 40.</div>
              </div>
              <div class="wizard-footer">
                <button class="btn btn-secondary" data-back>Voltar</button>
                <div>
                  <button class="btn btn-link" id="reset3">Reset</button>
                  <button class="btn btn-primary" id="toStep4" disabled>Continuar</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 4: Rubricas adicionais -->
        <section id="step4" class="step">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-2">Rubricas adicionais</h5>
              <p class="muted">Marque as rubricas opcionais que aparecem no seu contracheque.</p>
              <div id="optContainer" class="row"></div>
              <div class="wizard-footer mt-3">
                <button class="btn btn-secondary" data-back>Voltar</button>
                <div>
                  <button class="btn btn-link" id="reset4">Reset</button>
                  <button class="btn btn-primary" id="toStep5">Ver resultado</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 5: Resultado final -->
        <section id="step5" class="step">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title mb-2">Resultado</h5>
              <div id="resumo" class="mb-3"></div>
              <div class="table-responsive">
                <table class="table table-bordered table-sm" id="resultTable">
                  <thead>
                    <tr>
                      <th>Rubrica</th>
                      <th>Atual</th>
                      <th>A PARTIR DE 1º DE DEZEMBRO DE 2025</th>
                      <th>A PARTIR DE 1º DE JANEIRO DE 2026</th>
                    </tr>
                  </thead>
                  <tbody id="tbodyResult"></tbody>
                </table>
              </div>
              <div class="wizard-footer">
                <button class="btn btn-secondary" data-back>Voltar</button>
                <button class="btn btn-link" id="reset5">Reset</button>
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- Dataset idêntico ao arquivo original v3b -->
  <script id="dataset" type="application/json">{"ordered_pg": ["Coronel", "Tenente-Coronel", "Major", "Capitão", "Primeiro-Tenente", "Segundo-Tenente", "Subtenente", "Primeiro-Sargento", "Segundo-Sargento", "Terceiro-Sargento", "Cabo", "Soldado - 1ª Classe", "Soldado de 1ª Classe", "Soldado de 2ª Classe"], "rubricas": {"SOLDO": {"ATUAL": {"Coronel": 4352.85, "Tenente-Coronel": 4179.87, "Major": 3982.98, "Capitão": 3328.06, "Primeiro-Tenente": 3081.39, "Segundo-Tenente": 2852.19, "Subtenente": 2197.04, "Primeiro-Sargento": 1916.76, "Segundo-Sargento": 1644.7, "Terceiro-Sargento": 1467.77, "Cabo": 1110.73, "Soldado - 1ª Classe": 980.99, "Soldado de 2ª Classe": 980.99, "Soldado - 2ª Classe": 980.99}, "DEZ": {"Coronel": 4853.43, "Tenente-Coronel": 4660.56, "Major": 4441.02, "Capitão": 3710.79, "Primeiro-Tenente": 3435.75, "Segundo-Tenente": 3180.19, "Subtenente": 2449.7, "Primeiro-Sargento": 2137.7, "Segundo-Sargento": 1833.84, "Terceiro-Sargento": 1663.1, "Cabo": 1441.46, "Soldado - 1ª Classe": 1312.05, "Soldado - 2ª Classe": 1312.05, "Soldado de 2ª Classe": 1312.05}, "JAN": {"Coronel": 5411.57, "Tenente-Coronel": 5196.52, "Major": 4951.74, "Capitão": 4137.53, "Primeiro-Tenente": 3830.86, "Segundo-Tenente": 3545.91, "Subtenente": 2731.42, "Primeiro-Sargento": 2382.96, "Segundo-Sargento": 2044.73, "Terceiro-Sargento": 1854.36, "Cabo": 1653.11, "Soldado - 1ª Classe": 1518.69, "Soldado - 2ª Classe": 1518.69, "Soldado de 2ª Classe": 1518.69}}, "FORMACAO": {"ATUAL": {"Coronel": 435.2850000000001, "Tenente-Coronel": 417.987, "Major": 398.298, "Capitão": 332.80600000000004, "Primeiro-Tenente": 308.139, "Segundo-Tenente": 285.219, "Subtenente": 219.704, "Primeiro-Sargento": 191.67600000000002, "Segundo-Sargento": 164.47000000000003, "Terceiro-Sargento": 146.77700000000002, "Cabo": 111.07300000000001, "Soldado - 1ª Classe": 98.099}, "DEZ": {"Coronel": 485.3430000000001, "Tenente-Coronel": 466.05600000000004, "Major": 444.1020000000001, "Capitão": 371.079, "Primeiro-Tenente": 343.57500000000005, "Segundo-Tenente": 318.019, "Subtenente": 244.97, "Primeiro-Sargento": 213.76999999999998, "Segundo-Sargento": 183.38400000000001, "Terceiro-Sargento": 166.31, "Cabo": 144.14600000000002, "Soldado - 1ª Classe": 131.205}, "JAN": {"Coronel": 541.157, "Tenente-Coronel": 519.652, "Major": 495.174, "Capitão": 413.753, "Primeiro-Tenente": 383.086, "Segundo-Tenente": 354.591, "Subtenente": 273.142, "Primeiro-Sargento": 238.29600000000002, "Segundo-Sargento": 204.473, "Terceiro-Sargento": 185.436, "Cabo": 165.311, "Soldado - 1ª Classe": 151.869}}, "ESPECIALIZACAO": {"ATUAL": {"Coronel": 652.9275, "Tenente-Coronel": 626.9805, "Major": 597.447, "Capitão": 499.20899999999995, "Primeiro-Tenente": 462.20849999999996, "Segundo-Tenente": 427.8285, "Subtenente": 329.556, "Primeiro-Sargento": 287.514, "Segundo-Sargento": 246.70499999999998, "Terceiro-Sargento": 220.16549999999998, "Cabo": 166.6095, "Soldado - 1ª Classe": 147.14849999999998}, "DEZ": {"Coronel": 728.0145, "Tenente-Coronel": 699.0840000000001, "Major": 666.153, "Capitão": 556.6184999999999, "Primeiro-Tenente": 515.3625, "Segundo-Tenente": 477.0285, "Subtenente": 367.455, "Primeiro-Sargento": 320.655, "Segundo-Sargento": 275.07599999999996, "Terceiro-Sargento": 249.46499999999997, "Cabo": 216.219, "Soldado - 1ª Classe": 196.80749999999998}, "JAN": {"Coronel": 811.7354999999999, "Tenente-Coronel": 779.4780000000001, "Major": 742.761, "Capitão": 620.6294999999999, "Primeiro-Tenente": 574.629, "Segundo-Tenente": 531.8865, "Subtenente": 409.713, "Primeiro-Sargento": 357.444, "Segundo-Sargento": 306.7095, "Terceiro-Sargento": 278.154, "Cabo": 247.96649999999997, "Soldado - 1ª Classe": 227.8035}}, "APERFEICOAMENTO": {"ATUAL": {"Coronel": 870.5700000000002, "Tenente-Coronel": 835.974, "Major": 796.596, "Capitão": 665.6120000000001, "Primeiro-Tenente": 616.278, "Segundo-Tenente": 570.438, "Subtenente": 439.408, "Primeiro-Sargento": 383.35200000000003, "Segundo-Sargento": 328.94000000000005, "Terceiro-Sargento": 293.55400000000003, "Cabo": 222.14600000000002, "Soldado - 1ª Classe": 196.198}, "DEZ": {"Coronel": 970.6860000000001, "Tenente-Coronel": 932.1120000000001, "Major": 888.2040000000002, "Capitão": 742.158, "Primeiro-Tenente": 687.1500000000001, "Segundo-Tenente": 636.038, "Subtenente": 489.94, "Primeiro-Sargento": 427.53999999999996, "Segundo-Sargento": 366.76800000000003, "Terceiro-Sargento": 332.62, "Cabo": 288.29200000000003, "Soldado - 1ª Classe": 262.41}, "JAN": {"Coronel": 1082.314, "Tenente-Coronel": 1039.304, "Major": 990.348, "Capitão": 827.506, "Primeiro-Tenente": 766.172, "Segundo-Tenente": 709.182, "Subtenente": 546.284, "Primeiro-Sargento": 476.59200000000004, "Segundo-Sargento": 408.946, "Terceiro-Sargento": 370.872, "Cabo": 330.622, "Soldado - 1ª Classe": 303.738}}, "ALTOS_ESTUDOS": {"ATUAL": {"Coronel": 1305.855, "Tenente-Coronel": 1253.961, "Major": 1194.894, "Capitão": 998.4179999999999, "Primeiro-Tenente": 924.4169999999999, "Segundo-Tenente": 855.657, "Subtenente": 659.112, "Primeiro-Sargento": 575.028, "Segundo-Sargento": 493.40999999999997, "Terceiro-Sargento": 440.33099999999996, "Cabo": 333.219, "Soldado - 1ª Classe": 294.29699999999997}, "DEZ": {"Coronel": 1456.029, "Tenente-Coronel": 1398.1680000000001, "Major": 1332.306, "Capitão": 1113.2369999999999, "Primeiro-Tenente": 1030.725, "Segundo-Tenente": 954.057, "Subtenente": 734.91, "Primeiro-Sargento": 641.31, "Segundo-Sargento": 550.1519999999999, "Terceiro-Sargento": 498.92999999999995, "Cabo": 432.438, "Soldado - 1ª Classe": 393.61499999999995}, "JAN": {"Coronel": 1623.4709999999998, "Tenente-Coronel": 1558.9560000000001, "Major": 1485.522, "Capitão": 1241.2589999999998, "Primeiro-Tenente": 1149.258, "Segundo-Tenente": 1063.773, "Subtenente": 819.426, "Primeiro-Sargento": 714.888, "Segundo-Sargento": 613.419, "Terceiro-Sargento": 556.308, "Cabo": 495.93299999999994, "Soldado - 1ª Classe": 455.607}}, "AD_POST_GRAD": {"ATUAL": {"Coronel": 3482.2800000000007, "Tenente-Coronel": 3343.896, "Major": 3186.384, "Capitão": 2496.045, "Primeiro-Tenente": 2156.973, "Segundo-Tenente": 1996.533, "Subtenente": 1428.076, "Primeiro-Sargento": 1245.894, "Segundo-Sargento": 1069.055, "Terceiro-Sargento": 954.0505, "Cabo": 666.438, "Soldado - 1ª Classe": 588.5939999999999}, "DEZ": {"Coronel": 3882.7440000000006, "Tenente-Coronel": 3728.4480000000003, "Major": 3552.8160000000007, "Capitão": 2783.0924999999997, "Primeiro-Tenente": 2405.0249999999996, "Segundo-Tenente": 2226.133, "Subtenente": 1592.3049999999998, "Primeiro-Sargento": 1389.5049999999999, "Segundo-Sargento": 1191.996, "Terceiro-Sargento": 1081.0149999999999, "Cabo": 864.876, "Soldado - 1ª Classe": 787.2299999999999}, "JAN": {"Coronel": 4329.256, "Tenente-Coronel": 4157.216, "Major": 3961.392, "Capitão": 3103.1475, "Primeiro-Tenente": 2681.602, "Segundo-Tenente": 2482.1369999999997, "Subtenente": 1775.423, "Primeiro-Sargento": 1548.924, "Segundo-Sargento": 1329.0745, "Terceiro-Sargento": 1205.334, "Cabo": 991.8659999999999, "Soldado - 1ª Classe": 911.214}}, "ADIC_TEMP_SERVICO_MILITAR": {"ATUAL": {"Coronel": 1349.3835000000001, "Tenente-Coronel": 1295.7597, "Major": 1234.7238, "Capitão": 1031.6986, "Primeiro-Tenente": 955.2308999999999, "Segundo-Tenente": 884.1789, "Subtenente": 681.0824, "Primeiro-Sargento": 594.1956, "Segundo-Sargento": 509.857, "Terceiro-Sargento": 455.0087, "Cabo": 344.3263, "Soldado - 1ª Classe": 304.1069}, "DEZ": {"Coronel": 1504.5633, "Tenente-Coronel": 1444.7736000000002, "Major": 1376.7162, "Capitão": 1150.3449, "Primeiro-Tenente": 1065.0825, "Segundo-Tenente": 985.8589000000001, "Subtenente": 759.4069999999999, "Primeiro-Sargento": 662.6869999999999, "Segundo-Sargento": 568.4904, "Terceiro-Sargento": 515.5609999999999, "Cabo": 446.8526, "Soldado - 1ª Classe": 406.7355}, "JAN": {"Coronel": 1677.5866999999998, "Tenente-Coronel": 1610.9212000000002, "Major": 1535.0394, "Capitão": 1282.6343, "Primeiro-Tenente": 1187.5666, "Segundo-Tenente": 1099.2321, "Subtenente": 846.7402000000001, "Primeiro-Sargento": 738.7176000000001, "Segundo-Sargento": 633.8663, "Terceiro-Sargento": 574.8516, "Cabo": 512.4640999999999, "Soldado - 1ª Classe": 470.7939}}, "ADIC_OPERACOES_MILITARES_INAT": {"ATUAL": {"Coronel": 552.81195, "Tenente-Coronel": 552.81195, "Major": 552.81195, "Capitão": 552.81195, "Primeiro-Tenente": 552.81195, "Segundo-Tenente": 552.81195, "Subtenente": 552.81195, "Primeiro-Sargento": 552.81195, "Segundo-Sargento": 552.81195, "Terceiro-Sargento": 552.81195, "Cabo": 552.81195, "Soldado - 1ª Classe": 552.81195}, "DEZ": {"Coronel": 616.38561, "Tenente-Coronel": 616.38561, "Major": 616.38561, "Capitão": 616.38561, "Primeiro-Tenente": 616.38561, "Segundo-Tenente": 616.38561, "Subtenente": 616.38561, "Primeiro-Sargento": 616.38561, "Segundo-Sargento": 616.38561, "Terceiro-Sargento": 616.38561, "Cabo": 616.38561, "Soldado - 1ª Classe": 616.38561}, "JAN": {"Coronel": 687.2693899999999, "Tenente-Coronel": 687.2693899999999, "Major": 687.2693899999999, "Capitão": 687.2693899999999, "Primeiro-Tenente": 687.2693899999999, "Segundo-Tenente": 687.2693899999999, "Subtenente": 687.2693899999999, "Primeiro-Sargento": 687.2693899999999, "Segundo-Sargento": 687.2693899999999, "Terceiro-Sargento": 687.2693899999999, "Cabo": 687.2693899999999, "Soldado - 1ª Classe": 687.2693899999999}}, "COMPLEMENTO_SOLDO": {"ATUAL": {"Coronel": 0.0, "Tenente-Coronel": 0.0, "Major": 0.0, "Capitão": 0.0, "Primeiro-Tenente": 0.0, "Segundo-Tenente": 0.0, "Subtenente": 0.0, "Primeiro-Sargento": 0.0, "Segundo-Sargento": 0.0, "Terceiro-Sargento": 50.23000000000002, "Cabo": 407.27, "Soldado - 1ª Classe": 537.01}, "DEZ": {"Coronel": 0.0, "Tenente-Coronel": 0.0, "Major": 0.0, "Capitão": 0.0, "Primeiro-Tenente": 0.0, "Segundo-Tenente": 0.0, "Subtenente": 0.0, "Primeiro-Sargento": 0.0, "Segundo-Sargento": 0.0, "Terceiro-Sargento": 0.0, "Cabo": 76.53999999999996, "Soldado - 1ª Classe": 205.95000000000005}, "JAN": {"Coronel": 0.0, "Tenente-Coronel": 0.0, "Major": 0.0, "Capitão": 0.0, "Primeiro-Tenente": 0.0, "Segundo-Tenente": 0.0, "Subtenente": 0.0, "Primeiro-Sargento": 0.0, "Segundo-Sargento": 0.0, "Terceiro-Sargento": -336.3599999999999, "Cabo": -135.1099999999999, "Soldado - 1ª Classe": -0.6900000000000546}}, "VPE": {"ATUAL": {"Coronel": 13183.33, "Tenente-Coronel": 12689.09, "Major": 11410.69, "Capitão": 9643.36, "Primeiro-Tenente": 8513.28, "Segundo-Tenente": 8141.75, "Subtenente": 8489.56, "Primeiro-Sargento": 6050.18, "Segundo-Sargento": 5358.12, "Terceiro-Sargento": 4862.35, "Cabo": 4107.29, "Soldado - 1ª Classe": 3886.0, "Soldado - 2ª Classe": 2826.68}, "DEZ": {"Coronel": 13693.34, "Tenente-Coronel": 12911.53, "Major": 11541.96, "Capitão": 9649.17, "Primeiro-Tenente": 8814.5, "Segundo-Tenente": 8664.68, "Subtenente": 9086.5, "Primeiro-Sargento": 6393.99, "Segundo-Sargento": 5630.16, "Terceiro-Sargento": 5319.84, "Cabo": 4468.19, "Soldado - 1ª Classe": 4246.37, "Soldado - 2ª Classe": 2829.65}, "JAN": {"Coronel": 15452.11, "Tenente-Coronel": 13533.03, "Major": 11611.03, "Capitão": 10170.43, "Primeiro-Tenente": 10093.99, "Segundo-Tenente": 9873.7, "Subtenente": 10353.04, "Primeiro-Sargento": 7161.85, "Segundo-Sargento": 6240.41, "Terceiro-Sargento": 5905.03, "Cabo": 5343.21, "Soldado - 1ª Classe": 5110.76, "Soldado - 2ª Classe": 3647.61}}, "GFM": {"ATUAL": {"Coronel": 842.23, "Tenente-Coronel": 842.23, "Major": 842.23, "Capitão": 842.23, "Primeiro-Tenente": 842.23, "Segundo-Tenente": 842.23, "Subtenente": 561.49, "Primeiro-Sargento": 561.49, "Segundo-Sargento": 561.49, "Terceiro-Sargento": 561.49, "Cabo": 561.49, "Soldado de 1ª Classe": 561.49, "Soldado de 2ª Classe": 561.49, "Soldado - 1ª Classe": 561.49, "Soldado - 2ª Classe": 561.49}, "DEZ": {"Coronel": 939.09, "Tenente-Coronel": 939.09, "Major": 939.09, "Capitão": 939.09, "Primeiro-Tenente": 939.09, "Segundo-Tenente": 939.09, "Subtenente": 626.06, "Primeiro-Sargento": 626.06, "Segundo-Sargento": 626.06, "Terceiro-Sargento": 626.06, "Cabo": 626.06, "Soldado de 1ª Classe": 626.06, "Soldado de 2ª Classe": 626.06, "Soldado - 1ª Classe": 626.06, "Soldado - 2ª Classe": 626.06}, "JAN": {"Coronel": 1047.08, "Tenente-Coronel": 1047.08, "Major": 1047.08, "Capitão": 1047.08, "Primeiro-Tenente": 1047.08, "Segundo-Tenente": 1047.08, "Subtenente": 698.06, "Primeiro-Sargento": 698.06, "Segundo-Sargento": 698.06, "Terceiro-Sargento": 698.06, "Cabo": 698.06, "Soldado de 1ª Classe": 698.06, "Soldado de 2ª Classe": 698.06, "Soldado - 1ª Classe": 698.06, "Soldado - 2ª Classe": 698.06}}, "GEFM": {"ATUAL": {"Coronel": 3036.63, "Tenente-Coronel": 2920.89, "Major": 2485.61, "Capitão": 2046.67, "Primeiro-Tenente": 1702.92, "Segundo-Tenente": 1585.51, "Subtenente": 1347.72, "Primeiro-Sargento": 1192.72, "Segundo-Sargento": 955.13, "Terceiro-Sargento": 866.64, "Cabo": 671.13, "Soldado de 1ª Classe": 608.08, "Soldado de 2ª Classe": 411.44, "Soldado - 1ª Classe": 608.08, "Soldado - 2ª Classe": 411.44}, "DEZ": {"Coronel": 3385.84, "Tenente-Coronel": 3256.79, "Major": 2771.46, "Capitão": 2282.04, "Primeiro-Tenente": 1898.76, "Segundo-Tenente": 1767.84, "Subtenente": 1502.71, "Primeiro-Sargento": 1329.88, "Segundo-Sargento": 1064.97, "Terceiro-Sargento": 966.3, "Cabo": 748.31, "Soldado de 1ª Classe": 678.01, "Soldado de 2ª Classe": 458.76, "Soldado - 1ª Classe": 678.01, "Soldado - 2ª Classe": 458.76}, "JAN": {"Coronel": 3775.21, "Tenente-Coronel": 3631.32, "Major": 3090.17, "Capitão": 2544.47, "Primeiro-Tenente": 2117.11, "Segundo-Tenente": 1971.15, "Subtenente": 1675.52, "Primeiro-Sargento": 1482.82, "Segundo-Sargento": 1187.44, "Terceiro-Sargento": 1077.43, "Cabo": 834.37, "Soldado de 1ª Classe": 755.98, "Soldado de 2ª Classe": 511.51, "Soldado - 1ª Classe": 755.98, "Soldado - 2ª Classe": 511.51}}}, "aux": {"Coronel": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 3600.0, "DEZ": 4014.0, "JAN": 4475.61}, "SEM_DEP": {"ATUAL": 1200.0, "DEZ": 1338.0, "JAN": 1491.87}}, "Tenente-Coronel": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 3473.61, "DEZ": 3873.08, "JAN": 4318.48}, "SEM_DEP": {"ATUAL": 1157.87, "DEZ": 1291.03, "JAN": 1439.49}}, "Major": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 3256.66, "DEZ": 3631.18, "JAN": 4048.76}, "SEM_DEP": {"ATUAL": 1085.55, "DEZ": 1210.39, "JAN": 1349.58}}, "Capitão": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 2613.52, "DEZ": 2914.07, "JAN": 3249.19}, "SEM_DEP": {"ATUAL": 871.17, "DEZ": 971.35, "JAN": 1083.06}}, "Primeiro-Tenente": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 2284.63, "DEZ": 2547.36, "JAN": 2840.31}, "SEM_DEP": {"ATUAL": 761.54, "DEZ": 849.12, "JAN": 946.77}}, "Segundo-Tenente": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 2153.71, "DEZ": 2401.39, "JAN": 2677.55}, "SEM_DEP": {"ATUAL": 717.9, "DEZ": 800.46, "JAN": 892.51}}, "Subtenente": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1942.54, "DEZ": 2165.93, "JAN": 2415.01}, "SEM_DEP": {"ATUAL": 647.51, "DEZ": 721.97, "JAN": 805.0}}, "Primeiro-Sargento": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1763.5, "DEZ": 1966.3, "JAN": 2192.43}, "SEM_DEP": {"ATUAL": 587.83, "DEZ": 655.43, "JAN": 730.8}}, "Segundo-Sargento": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1516.07, "DEZ": 1690.42, "JAN": 1884.82}, "SEM_DEP": {"ATUAL": 505.36, "DEZ": 563.48, "JAN": 628.28}}, "Terceiro-Sargento": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1398.52, "DEZ": 1559.35, "JAN": 1738.68}, "SEM_DEP": {"ATUAL": 466.17, "DEZ": 519.78, "JAN": 579.55}}, "Cabo": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1157.83, "DEZ": 1290.98, "JAN": 1439.44}, "SEM_DEP": {"ATUAL": 385.94, "DEZ": 430.32, "JAN": 479.81}}, "Soldado - 1ª Classe": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 1095.58, "DEZ": 1221.57, "JAN": 1362.05}, "SEM_DEP": {"ATUAL": 365.19, "DEZ": 407.19, "JAN": 454.01}}, "Soldado - 2ª Classe": {"NAO": {"ATUAL": 0.0, "DEZ": 0.0, "JAN": 0.0}, "COM_DEP": {"ATUAL": 850.59, "DEZ": 948.41, "JAN": 1057.47}, "SEM_DEP": {"ATUAL": 283.53, "DEZ": 316.14, "JAN": 352.49}}}}</script>

  <script>
  (function(){
    // Utilidades
    const DATA = JSON.parse(document.getElementById('dataset').textContent || '{}');
    const steps = ['step0','step1','step2','step3','step4','step5'];
    let state = { posto:'', aux:'NAO', vpe:'NAO', tempo: 30, opcionais: [] };

    function showStep(id) {
      steps.forEach(s => document.getElementById(s).classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }
    function resetAll() {
      state = { posto:'', aux:'NAO', vpe:'NAO', tempo: 30, opcionais: [] };
      document.getElementById('postoSel').value = '';
      document.getElementById('auxNao').checked = true;
      document.getElementById('vpeNao').checked = true;
      const ti = document.getElementById('tempoInput');
      if (ti) { ti.value = 30; ti.classList.remove('is-invalid'); }
      document.querySelectorAll('[data-opt]').forEach(ch => ch.checked = false);
      document.getElementById('toStep2').disabled = true;
      const btnS3 = document.getElementById('toStep4'); if (btnS3) btnS3.disabled = false;
      document.getElementById('tbodyResult').innerHTML = '';
      document.getElementById('resumo').innerHTML = '';
      showStep('step0');
    }
    function validTempo(n) {
      return Number.isInteger(n) && n >= 1 && n <= 40;
    }

    // Normalização para lookup por rótulo com/sem acento
    function __norm(s) { return !s ? '' : s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').toLowerCase().trim(); }
    // Canonicalize PG labels so variants collapse into one
    function __canonKey(s){
      if(!s) return '';
      let t = s.normalize('NFD').toLowerCase();
      t = t.replace(/[ª]/g,'a').replace(/[º]/g,'o');
      t = t.replace(/[\u0300-\u036f]/g,''); // remove combining marks
      t = t.replace(/[\s\-_.]/g,'');       // strip spaces, hyphens, underscores, dots
      return t;
    }
    const __CANON_LABELS = {
      "soldado1aclasse": "Soldado - 1ª Classe",
      "soldadode1aclasse": "Soldado - 1ª Classe",
      "soldadode2aclasse": "Soldado - 2ª Classe"
    };
    function __canonLabel(s){
      const k = __canonKey(s);
      return __CANON_LABELS[k] || s;
    }
    function __lookup(map, key){
      const nk = __norm(key);
      for (const k in map) if (__norm(k)===nk) return map[k];
      // Try canonical fallback
      const canon = __canonLabel(key);
      if (canon !== key){
        const nk2 = __norm(canon);
        for (const k in map) if (__norm(k)===nk2) return map[k];
      }
      return null;
    }
    function clamp0(n){ if(n==null||isNaN(n)) return null; return n<0 ? 0 : n; }
    function fmt(v) { return (v==null||isNaN(v)) ? '' : Number(v).toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:2}); }

    // Preencher Posto/Graduação na ordem da planilha (dedupe variantes)
    const selectPG = document.getElementById('postoSel');
    const ORDER = (DATA.ordered_pg && DATA.ordered_pg.length) ? DATA.ordered_pg : [];
    (function(){
      const seen = new Set();
      const items = [];
      ORDER.forEach((p) => {
        const canon = __canonLabel(p);
        const key = __canonKey(canon);
        if(!seen.has(key)){
          seen.add(key);
          items.push(canon);
        }
      });
      items.forEach((label) => {
        const opt = document.createElement('option');
        opt.value = label;
        opt.textContent = label;
        selectPG.appendChild(opt);
      });
    })();
    // Construção das opções opcionais (Rubricas opcionais)
    const OPTIONAL = [
      ['ESPECIALIZACAO','Especialização'],
      ['APERFEICOAMENTO','Aperfeiçoamento'],
      ['ALTOS_ESTUDOS','Altos Estudos'],
      ['AD_POST_GRAD','AD. POST/GRAD'],
      ['ADIC_TEMP_SERVICO_MILITAR','ADIC.TEMP.SERVIÇO-MILITAR'],
      ['ADIC_OPERACOES_MILITARES_INAT','ADIC.OPERAÇÕES MILITARES INAT'],
    ];
    const optBox = document.getElementById('optContainer');
    OPTIONAL.forEach(([id,label])=>{
      const col = document.createElement('div');
      col.className='col-12 col-md-6';
      col.innerHTML = `
        <div class="custom-control custom-checkbox mb-2">
          <input type="checkbox" class="custom-control-input" id="opt__${id}" data-opt="${id}">
          <label class="custom-control-label" for="opt__${id}">${label}</label>
        </div>`;
      optBox.appendChild(col);
    });

    // Navegação
    document.getElementById('startBtn').addEventListener('click', ()=> showStep('step1'));
    document.querySelectorAll('[data-back]').forEach(btn => btn.addEventListener('click', ()=>{
      const current = steps.find(s => document.getElementById(s).classList.contains('active'));
      const idx = steps.indexOf(current);
      showStep(steps[Math.max(0, idx-1)]);
    }));
    document.getElementById('resetTop').addEventListener('click', resetAll);
    document.getElementById('reset0').addEventListener('click', resetAll);
    document.getElementById('reset1').addEventListener('click', resetAll);
    document.getElementById('reset2').addEventListener('click', resetAll);
    document.getElementById('reset3').addEventListener('click', resetAll);
    document.getElementById('reset4').addEventListener('click', resetAll);
    document.getElementById('reset5').addEventListener('click', resetAll);

    // Step 1 controls
    selectPG.addEventListener('change', (e)=>{
      state.posto = e.target.value || '';
      document.getElementById('toStep2').disabled = !state.posto;
    });
    document.getElementById('toStep2').addEventListener('click', ()=> showStep('step2'));

    // Step 2 controls
    document.getElementsByName('aux').forEach(r => r.addEventListener('change', (e)=> state.aux = e.target.value));
    document.getElementsByName('vpe').forEach(r => r.addEventListener('change', (e)=> state.vpe = e.target.value));
    document.getElementById('toStep3').addEventListener('click', ()=> showStep('step3'));

    // Step 3 controls (Tempo de Serviço)
    const tempoInput = document.getElementById('tempoInput');
    const toStep4Btn = document.getElementById('toStep4');
    function validateTempoAndState(){
      let n = parseInt(tempoInput.value, 10);
      if (!Number.isFinite(n)) n = 0;
      if (!validTempo(n)) {
        tempoInput.classList.add('is-invalid');
        toStep4Btn.disabled = true;
      } else {
        tempoInput.classList.remove('is-invalid');
        toStep4Btn.disabled = false;
        state.tempo = n;
      }
    }
    tempoInput.addEventListener('input', validateTempoAndState);
    tempoInput.addEventListener('blur', ()=>{
      let n = parseInt(tempoInput.value, 10);
      if (!Number.isFinite(n)) n = 30;
      n = Math.max(1, Math.min(40, n));
      tempoInput.value = n;
      validateTempoAndState();
    });
    validateTempoAndState();
    toStep4Btn.addEventListener('click', ()=> showStep('step4'));

    // Step 4 controls (Rubricas adicionais)
    document.querySelectorAll('[data-opt]').forEach(ch => ch.addEventListener('change', ()=>{
      state.opcionais = Array.from(document.querySelectorAll('[data-opt]:checked')).map(el => el.getAttribute('data-opt'));
    }));
    document.getElementById('toStep5').addEventListener('click', ()=>{ renderFinal(); showStep('step5'); });

    function currentLabelList() {
      const FIXED = [
        ['SOLDO','SOLDO'],
        ['GRAT_REP_MILITAR','GRATIFICAÇÃO DE REPRES. MILITAR (1% do soldo)'],
        ['FORMACAO','AD. CERT. PROF. (FORMACAO)'],
        ['COMPLEMENTO_SOLDO','COMPLEMENTO DE SOLDO'],
        ['GFM','GFM'],
        ['GEFM','GEFM'],
        ['VPE','VPE'],
        ['AUX_MORADIA','AUXÍLIO MORADIA'],
      ];
      const optPairs = OPTIONAL.filter(([id]) => state.opcionais.includes(id));
      return [...FIXED, ...optPairs];
    }

    function renderFinal() {
      const tbody = document.getElementById('tbodyResult');
      tbody.innerHTML = '';
      const p = state.posto;
      if (!p) return;

      const resumo = document.getElementById('resumo');
      const auxLabel = ({'NAO':'Não','COM_DEP':'Com dependente','SEM_DEP':'Sem dependente'})[state.aux] || 'Não';
      const vpeLabel = state.vpe === 'SIM' ? 'Sim' : 'Não';
      const ops = state.opcionais.map(id => OPTIONAL.find(o=>o[0]===id)?.[1]).filter(Boolean);
      resumo.innerHTML = `
        <div class="mb-2">
          <span class="chip"><strong>Posto/Graduação:</strong> ${p}</span>
          <span class="chip"><strong>Auxílio-moradia:</strong> ${auxLabel}</span>
          <span class="chip"><strong>VPE:</strong> ${vpeLabel}</span>
          <span class="chip"><strong>Tempo de serviço:</strong> ${state.tempo} anos</span>
          ${ops.map(o=>`<span class="chip">${o}</span>`).join('')}
        </div>`;

      const soldo = DATA.rubricas?.SOLDO || {ATUAL:{},DEZ:{},JAN:{}};

      currentLabelList().forEach(([key,label])=>{
        if (key==='VPE' && state.vpe==='NAO') return;
        if (key==='AUX_MORADIA' && state.aux==='NAO') return;

        const tr = document.createElement('tr');
        const td0 = document.createElement('td'); td0.textContent = label; tr.appendChild(td0);
        const tdA = document.createElement('td');
        const tdD = document.createElement('td');
        const tdJ = document.createElement('td');

        if (key==='AUX_MORADIA') {
          const row = (DATA.aux && DATA.aux[p]) ? DATA.aux[p] : null;
          const vA = row ? row[state.aux]?.ATUAL : null;
          const vD = row ? row[state.aux]?.DEZ   : null;
          const vJ = row ? row[state.aux]?.JAN   : null;
          tdA.textContent = fmt(vA); tdD.textContent = fmt(vD); tdJ.textContent = fmt(vJ);
        } else if (key==='GRAT_REP_MILITAR') {
          const sA = __lookup(soldo.ATUAL||{}, p);
          const sD = __lookup(soldo.DEZ  ||{}, p);
          const sJ = __lookup(soldo.JAN  ||{}, p);
          const vA = (sA==null) ? null : sA * 0.01;
          const vD = (sD==null) ? null : sD * 0.01;
          const vJ = (sJ==null) ? null : sJ * 0.01;
          tdA.textContent = fmt(vA); tdD.textContent = fmt(vD); tdJ.textContent = fmt(vJ);
        } else if (key==='VPE') {
          // Novo: VPE = VPE - GFM - GEFM
          const mapVPE = DATA.rubricas?.VPE || {ATUAL:{},DEZ:{},JAN:{}};
          const mapGFM = DATA.rubricas?.GFM || {ATUAL:{},DEZ:{},JAN:{}};
          const mapGEFM = DATA.rubricas?.GEFM || {ATUAL:{},DEZ:{},JAN:{}};

          function minus(a,b,c) {
            const A = (a==null?null:Number(a));
            if (A==null || isNaN(A)) return null;
            const B = (b==null?0:Number(b));
            const C = (c==null?0:Number(c));
            return A - (isNaN(B)?0:B) - (isNaN(C)?0:C);
          }

          const vA = minus(__lookup(mapVPE.ATUAL||{}, p), __lookup(mapGFM.ATUAL||{}, p), __lookup(mapGEFM.ATUAL||{}, p));
          const vD = minus(__lookup(mapVPE.DEZ  ||{}, p), __lookup(mapGFM.DEZ  ||{}, p), __lookup(mapGEFM.DEZ  ||{}, p));
          const vJ = minus(__lookup(mapVPE.JAN  ||{}, p), __lookup(mapGFM.JAN  ||{}, p), __lookup(mapGEFM.JAN  ||{}, p));

          tdA.textContent = fmt(vA); tdD.textContent = fmt(vD); tdJ.textContent = fmt(vJ);
        } else if (key==='ADIC_TEMP_SERVICO_MILITAR') {
          const rate = state.tempo / 100;
          const sA = __lookup(soldo.ATUAL||{}, p);
          const sD = __lookup(soldo.DEZ  ||{}, p);
          const sJ = __lookup(soldo.JAN  ||{}, p);
          const vA = (sA==null) ? null : sA * rate;
          const vD = (sD==null) ? null : sD * rate;
          const vJ = (sJ==null) ? null : sJ * rate;
          tdA.textContent = fmt(vA); tdD.textContent = fmt(vD); tdJ.textContent = fmt(vJ);
        } else {
          const map = DATA.rubricas[key] || {ATUAL:{},DEZ:{},JAN:{}};
          let vA = __lookup(map.ATUAL||{}, p);
          let vD = __lookup(map.DEZ  ||{}, p);
          let vJ = __lookup(map.JAN  ||{}, p);
          if (key==='COMPLEMENTO_SOLDO') { vA = clamp0(vA); vD = clamp0(vD); vJ = clamp0(vJ); }
          tdA.textContent = fmt(vA); tdD.textContent = fmt(vD); tdJ.textContent = fmt(vJ);
        }

        if (key==='COMPLEMENTO_SOLDO') {
          const toNum = (x) => (x===''||x==null) ? 0 : Number(String(x).replace(/\./g,'').replace(',','.'))||0;
          if (toNum(tdA.textContent)===0 && toNum(tdD.textContent)===0 && toNum(tdJ.textContent)===0) return;
        }

        tr.appendChild(tdA); tr.appendChild(tdD); tr.appendChild(tdJ);
        tbody.appendChild(tr);
      });
    }

    // Inicializar
    resetAll();
  })();
  </script>
</body>
</html>